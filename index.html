<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>TXC GRIDRUN (Prototype)</title>
  <style>
    html, body { margin:0; padding:0; background:#0a0a12; height:100%; overflow:hidden; }
    canvas { display:block; margin:0 auto; }
    .hint{
      position:fixed; left:12px; bottom:10px;
      font:12px/1.35 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      color:rgba(255,255,255,.75);
      background:rgba(0,0,0,.35);
      padding:8px 10px; border-radius:10px;
      user-select:none; z-index:10;
    }
  </style>
</head>
<body>
<div class="hint">PC: WASD / Arrows â€¢ Mobile: drag thumb (fast analog)</div>

<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

<script>
window.addEventListener("load", () => {
  const wait = setInterval(() => {
    if (typeof Phaser === "undefined") return;
    clearInterval(wait);

    const W = 420, H = 760;
    const uiFont = "system-ui,-apple-system,Segoe UI,Roboto,sans-serif";

    const GRID_COLS = 7, GRID_ROWS = 13, TILE = 52;
    const GRID_W = GRID_COLS * TILE, GRID_H = GRID_ROWS * TILE;
    const GRID_X = (W - GRID_W) / 2, GRID_Y = (H - GRID_H) / 2;

    const PLAYER_SPEED = 320;
    const BASE_SCROLL = 120;
    const SPAWN_START_MS = 850;
    const SPAWN_MIN_MS = 320;

    // ðŸ”¥ Faster mobile response
    const ANALOG_MAX_DIST = 110;
    const ANALOG_DEADZONE = 4;
    const ANALOG_BOOST = 1.25; // extra punch

    const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));

    class PlayScene extends Phaser.Scene {
      constructor() {
        super("Play");
        this.touchTarget = null;
      }

      create() {
        this.cameras.main.setBackgroundColor(0x0a0a12);
        this.gridGraphics = this.add.graphics();
        this.gridOffset = 0;

        this.obstacles = this.physics.add.group({ immovable:true, allowGravity:false });

        const startX = GRID_X + GRID_W / 2;
        const startY = GRID_Y + GRID_H * 0.72;
        this.player = this.add.rectangle(startX, startY, 28, 28, 0x6ef3ff);
        this.physics.add.existing(this.player);
        this.player.body.setAllowGravity(false);

        this.physics.add.overlap(this.player, this.obstacles, () => this.scene.restart());

        this.cursors = this.input.keyboard.createCursorKeys();
        this.keys = this.input.keyboard.addKeys("W,A,S,D");

        this.input.on("pointerdown", p => this.touchTarget = { x:p.x, y:p.y });
        this.input.on("pointermove", p => { if (p.isDown) this.touchTarget = { x:p.x, y:p.y }; });
        this.input.on("pointerup", () => this.touchTarget = null);

        this.scoreText = this.add.text(14,12,"Score: 0",{ fontFamily:uiFont, fontSize:"16px", color:"#fff" });

        this.elapsed = 0;
        this.spawnEvery = SPAWN_START_MS;
        this.spawnTimer = 0;
      }

      update(_, deltaMs) {
        const dt = deltaMs / 1000;
        this.elapsed += dt;

        let vx = 0, vy = 0;
        if (this.cursors.left.isDown || this.keys.A.isDown) vx -= 1;
        if (this.cursors.right.isDown || this.keys.D.isDown) vx += 1;
        if (this.cursors.up.isDown || this.keys.W.isDown) vy -= 1;
        if (this.cursors.down.isDown || this.keys.S.isDown) vy += 1;

        // âš¡ FAST analog thumb-follow
        if (this.touchTarget) {
          const dx = this.touchTarget.x - this.player.x;
          const dy = this.touchTarget.y - this.player.y;

          const ax = Math.abs(dx) > ANALOG_DEADZONE ? dx : 0;
          const ay = Math.abs(dy) > ANALOG_DEADZONE ? dy : 0;

          vx += Phaser.Math.Clamp((ax / ANALOG_MAX_DIST) * ANALOG_BOOST, -1, 1);
          vy += Phaser.Math.Clamp((ay / ANALOG_MAX_DIST) * ANALOG_BOOST, -1, 1);
        }

        const mag = Math.hypot(vx, vy);
        if (mag > 1) { vx /= mag; vy /= mag; }

        this.player.body.setVelocity(vx * PLAYER_SPEED, vy * PLAYER_SPEED);

        const pad = 14;
        this.player.x = clamp(this.player.x, GRID_X + pad, GRID_X + GRID_W - pad);
        this.player.y = clamp(this.player.y, GRID_Y + pad, GRID_Y + GRID_H - pad);
        this.player.body.reset(this.player.x, this.player.y);

        this.scoreText.setText("Score: " + Math.floor(this.elapsed * 10));
      }
    }

    new Phaser.Game({
      type: Phaser.AUTO,
      width: W,
      height: H,
      physics: { default:"arcade", arcade:{ debug:false } },
      scene: [PlayScene]
    });
  }, 50);
});
</script>
</body>
</html>
